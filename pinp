#!/bin/bash

# Config file 
PINPCONF="$HOME/.config/pinp/pinp.conf"

# Create config file if does not exist
if [ ! -f $PINPCONF ]; then
       install -D -m644 /etc/pinp/pinp.conf.default $PINPCONF 
fi

# Import settings from config file
. $PINPCONF

# Set basic options to enable mpv picture-in-picture mode
mpv_options="--ontop --no-border --on-all-workspaces --autofit=$SIZE --geometry=$POSITION"


play_local()
{
        mpv $mpv_options "$1"
}

stream_url()
{
        mpv $mpv_options --ytdl-format "$1" "$2" 
}


# Check that only one argument has been passed... 
if [[ $# -gt 1 ]]; then
        echo "pinp only takes one argument: the video or url you want to play."
        exit
else
        # ...and assign that as the source to play
        _url="$1"
fi


# Check if link is for a youtube video
if [[ "$_url" =~ ^"https://www.youtube.com" ]]; then
        _type="yt"
# if it is a link, but NOT from youtube treat as general url
elif [[ "$_url" =~ ^"http" && "$_url" != *"youtube.com"* ]]; then      
        _type="url"        
# if content is NOT a link, assume local video file
elif [[ ! "$_url" =~ ^"http" ]]; then
        _type="local"        
fi


case "$_type" in
                
        # stream youtube video
        yt) stream_url $YT_FORMAT "$_url";;

        # stream provided URL
        url) stream_url $FORMAT "$_url";;

        # stream local file
        local) play_local "$_url";;

        # echo an error 
        *) echo "Cannot identify the source.";; 

esac


